syntax = "proto3";
import "exchange.proto";
import "google/protobuf/empty.proto";
package user;

service User {
    rpc QueryOrders(RequestOrders) returns (QueryOrdersReply);
    rpc QueryPositions(RequestPositions) returns (QueryPositionsReply);
    rpc QueryFuturesAccountBalance(RequestFuturesAccountBalance) returns (QueryFuturesAccountBalanceReply);
    rpc QueryAccountInfo(RequestAccountInfo) returns (QueryAccountInfoReply);
    rpc SubscribeAccountUpdate(google.protobuf.Empty) returns (stream AccountUpdateEventReply);
}

message AccountUpdateEventReply {
      oneof payload {
        OrderUpdate order_update = 1;
        OrderUpdates order_updates = 2;
        AccountUpdate account_update = 3;
        BalanceChanged balance_changed = 4;
      }
}

message BalanceChanged {
    int64 balance_changed = 1;
    string asset = 2;
    int64 updated_at = 3;
}

message AccountUpdate {
    int64 balance = 1;
    bool is_balance_changed = 2;
    repeated PositionInfo positions = 3;
    bool is_positions_changed = 4;
}

message OrderUpdates {
    repeated OrderUpdate orders = 1;
}

message OrderUpdate {
    string order_id = 1;
    exchange.OrderStatus status = 2;
    int64 size = 3;
    int64 price = 4;
    int64 last_filled = 5;
    int64 filled = 6;
    uint32 market_id = 7;
    string cloid = 8;
    bool use_last_filled = 9;
}

message RequestOrders {
    uint32 market = 1;
}

message QueryOrdersReply {
    repeated OrderInfo orders = 1;
}

message OrderInfo {
    string id = 1;
    uint32 market_id = 2;
    int64 size = 3;
    int64 price = 4;
    int64 timestamp = 5;
    bool reduce_only = 6;
    exchange.OrderType order_type = 7;
    string cloid = 8;
}

message RequestPositions {
    int64 timestamp = 1;
}

message QueryPositionsReply {
    repeated PositionInfo positions = 1;
}

message PositionInfo {
    uint32 market_id = 1;
    int64 size = 2;
    int64 entry_price = 3;
}

message RequestFuturesAccountBalance {
    int64 timestamp = 1;
}

message QueryFuturesAccountBalanceReply {
    repeated AccountAssetBalance assets = 1;
}

message RequestAccountInfo {
    int64 timestamp = 1;
}

message QueryAccountInfoReply {
    int64 total_wallet_balance = 1;
    int64 total_margin_balance = 2;
    int64 available_balance = 3;
    repeated PositionInfo positions = 4;
}

message AccountAssetBalance {
    string asset = 1;
    int64 balance = 2;
    int64 update_time= 3;
}

