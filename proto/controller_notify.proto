syntax = "proto3";
import "google/protobuf/empty.proto";

package controller_notify;

service ControllerNotifyService {
    rpc NotifyStreamProposal(stream StreamProposal) returns (stream StreamProposalResponse);
    rpc AutoCancelOrders(AutoCancelOrdersProposal) returns (google.protobuf.Empty);
}

message NewOrderProposal {
    uint32 exchange_id = 1;
    uint32 market_id = 2;
    int64 size = 3;
    int64 price = 4;
    uint32 time_cancel_after_place = 5;
    bool reduce_only = 6;
}

message NewOrdersProposal {
    repeated NewOrderProposal base_orders = 1;
    repeated NewOrderProposal hedge_orders = 2;
    bool no_hedge = 3;
    int64 max_spread = 4;
}

message CancelOrdersProposal {
    int64 max_price_for_buy = 1;
    int64 min_price_for_sell = 2;
    uint32 exchange_id = 3;
    uint32 market_id = 4;
}

message AutoCancelOrdersProposal {
    uint32 exchange_id = 1;
    uint64 countdown_time = 2;
    int64 event_timestamp = 3;
}

message CancelOrdersByCloidProposal {
    repeated string cloids = 1;
}


message HandleOrdersProposal {
    NewOrdersProposal new_orders = 1;
    repeated CancelOrdersProposal cancel_orders = 2;
    int64 event_timestamp = 3;
}

message StreamProposal {
    oneof payload {
        HandleOrdersProposal handle_order_proposal = 1;
        AutoCancelOrdersProposal auto_cancel_orders_proposal = 2;
        CancelOrdersByCloidProposal cancel_orders_cloid = 3;
    }
}

message StreamProposalResponse {
    uint64 counter = 1;
}